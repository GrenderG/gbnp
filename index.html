<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Game Boy Nintendo Power ROM Builder</title>
    <script src="script/vue.min.js"></script>
    <script id="devload" src="script/devload.js"></script>
    <script src="script/gbnp.js"></script>
    <link rel="stylesheet" type="text/css" href="style/style.css" />
    <link rel="stylesheet" type="text/css" href="live-preview/style/style.css" />
    <link rel="shortcut icon" type="image/png" href="img/favicon.png"/>
  </head>

  <body>
    <h1>GAME BOY Nintendo Power ROM Builder</h1>
    <div class='text-container'>
      This tool can build the data necessary to flash new games to a <a href="https://en.wikipedia.org/wiki/Nintendo_Power_(cartridge)">Nintendo Power Game Boy cart</a>, as well as the <a href="https://shop.insidegadgets.com/product/gameboy-1mb-128kb-sram-power-cart-multi-game-and-multi-save/">insideGadgets Power Cart</a>. The menu can have up to seven roms, or a total of 896KB of game data. For flashing, I recommend the <a href="https://www.gbxcart.com/">GBxCart</a>.
    </div>
    <noscript>
      Looks like you have JS disabled. This tool needs javascript to function!
    </noscript>
    <div id="app">
      <h2>1. Select Your Cartridge</h2>
      <section>
        <div class="cart-option" v-on:click="$refs.r1.click()" :class="{selected: cartType == 0}"><div>
          <input v-model="cartType" type="radio" value="0" ref="r1" name="cart-selection" id="cs1"/>
          <label for="cs1">Nintendo GB Memory Cart</label>
        </div></div>
        <div class="cart-option" v-on:click="$refs.r2.click()" :class="{selected: cartType == 1}"><div>
          <input v-model="cartType" type="radio" value="1" ref="r2" name="cart-selection" id="cs2"/>
          <label for="cs2">insideGadgets Power Cart</label>
        </div></div>
      </section>
      <h2>2. Add Game ROMs</h2>
      <section>
        <table>
          <thead>
            <tr>
              <th>       
                <button v-on:click="removeAllRoms" class="remove-all" :disabled="roms.length == 0" type="button" >
                  <label>Remove All</label>
                </button>
              </th>
              <th>Title</th>
              <th>Mapper</th>
              <th>ROM</th>
              <th>RAM</th>
              <th>Blocks</th>
              <th>Menu Title</th>
              <th>Preview</th>
            </tr>
          </thead>
          <tbody>
            <tr v-for="(rom, index) in roms" v-bind:key="index">
              <td>
                <button id="remove-rom" v-on:click="removeROM(index)" type="button">✗</button>
                <button :disabled="index == 0" v-on:click="moveUp(index)" type="button">↑</button>
                <button :disabled="index == (roms.length - 1)" v-on:click="moveDown(index)" type="button">↓</button>
              </td>
              <td>{{ rom.title }}</td>
              <td>{{ rom.type }}</td>
              <td>{{ rom.romSizeKB() + 'k'}}</td>
              <td>{{ rom.ramSizeKB() + 'k' }}</td>
              <td>{{ rom.paddedRomSizeKB() / 128 + ' (' + rom.paddedRomSizeKB() + 'k)'}}</td>
              <td>
                <input type="text" class='menu-text' :value="rom.menuText" @input="e => updateMenuText(rom, e.target.value)"/>
              </td>
              <td>
                <bitmap-preview :data="rom.bitmapPreviewBuffer"/>
              </td>
            </tr>
          </tbody>
          <tfoot>
            <tr>
              <td>
                <button v-on:click="triggerAddRomLabel" class="upload" :disabled="!menu.present() || romOverflow" type="button">
                  <label for="romFileInput" ref="addRomLabel" v-on:click="stopPropagation">Add Games</label>
                </button>
                <input style="display: none" id="romFileInput" type="file" v-on:change="addROM" :disabled="!menu.present() || romOverflow" accept=".gb,.gbc" multiple>
              </td>
              <td>
                <button v-on:click="triggerAddMenuLabel" class="upload" type="button">
                  <label for="menuFileInput" ref="addMenuLabel" v-on:click="stopPropagation">Load From Previous</label>
                </button>
                <input style="display: none" id="menuFileInput" type="file" v-on:change="addMenu" accept=".gb,.gbc">
              </td>
              <td></td>
              <td>{{ processor.romTotalKB() + 'k' }}</td>
              <td>{{ processor.ramUsedKB() + 'k' }}</td>
              <td :class="{ overflow: romOverflow }">
                {{ processor.romUsedKB() / 128 + ' (' + processor.romUsedKB() + 'k)'}}
              </td>
              <td :class="{ overflow: romOverflow }">
                <span v-if="romOverflow">Limit is 7 blocks</span>
              </td>
              <td></td>
            </tr>
          </tfoot>
        </table>
      </section>

      <h2>3. Tweak Settings </h2>
      <section>
        <div class="settings-row">
          <span class="settings-label">Menu Font: </span>

          <input type="radio" id="font0" name="font" value="0" v-model="fontIndex">
          <label for="font0" id="gameboy" class="radio-label">Game Boy</label>

          <input type="radio" id="font1" name="font" value="1" v-model="fontIndex">
          <label for="font1" id="pokemon" class="radio-label">POKEMON</label>

          <input type="radio" id="font2" name="font" value="2" v-model="fontIndex">
          <label for="font2" id="nokia" class="radio-label">Nokia</label>

          <input type="radio" id="font3" name="font" value="3" v-model="fontIndex">
          <label for="font3" id="gamer" class="radio-label">Gamer</label>
        </div>

        <div class="settings-row">
          <label class="settings-label" for="forceDMG-input">Force DMG Menu: </label>
          <input id="forceDMG-input" type="checkbox" v-model:checked="forceDMG"/>
          <label for="forceDMG-input">The DMG menu and music will be used on color systems.</label> <a href="img/menu_comparison.png">Comparison here.</a>
        </div>

        <ticker-settings :processor="processor" :font-index="fontIndex" :fonts-loaded="fontsLoaded" @update="updateLivePreview()"></ticker-settings>

        <div class="settings-row">
          <label class="settings-label" id="filename-label" for="filename-input">Download Filename: </label>
          <input id="filename-input" type="text" v-model:value="filename"/>
        </div>
      </section>

      <h2>4. Download Files</h2>
      <section>
        <a class='download-link' :download="filename + '.gb'" :href="downloadEnabled ? romData : null" type="application/octet-stream" v-on:click="downloadRomFile" :class="{ disabled: !downloadEnabled }">Download GB File</a>
        /
        <a class='download-link' :download="filename + '.map'" :href="downloadEnabled && mapEnabled ? mapData : null" type="application/octet-stream" v-on:click="downloadMapFile" :class="{ disabled: (!downloadEnabled || !mapEnabled) }">Download MAP File</a>
      </section>

      <div class="preview">
        <canvas id="mainCanvas">No Canvas Support</canvas>
        <div>
          <input id="preview-mute" type="checkbox" />
          <label for="preview-mute">Mute</label>
          <input id="preview-color" type="checkbox" />
          <label for="preview-color">Color</label> 
        </div>
      </div>
    </div>

    <footer>
      <a href="https://github.com/orangeglo/gbnp">view this project on github</a>
      -
      by orangeglo (orangeglo#6197 on Discord)
    </footer>

    <script src="live-preview/js/other/mobile.js"></script>
    <script src="live-preview/js/other/swfobject.js"></script>
    <script src="live-preview/js/other/resampler.js"></script>
    <script src="live-preview/js/other/XAudioServer.js"></script>
    <script src="live-preview/js/GameBoyCore.js"></script>
    <script src="live-preview/js/GameBoyIO.js"></script>  

    <script src="script/app.js"></script>
  </body>
</html>
