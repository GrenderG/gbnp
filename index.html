<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Game Boy Nintendo Power ROM Builder</title>
    <script src="script/vue.min.js"></script>
    <script id="devload" src="script/devload.js"></script>
    <script src="script/gbnp.js"></script>
    <link rel="stylesheet" type="text/css" href="style/style.css" />
  </head>

  <body>
    <h1>GAME BOY Nintendo Power ROM Builder</h1>
    <div class='text-container'>
      This tool can build the data necessary to flash new games to a <a href="https://en.wikipedia.org/wiki/Nintendo_Power_(cartridge)">Nintendo Power Game Boy cart</a>. The cartridge can store up to seven roms, or a total of 896KB of game data. For flashing, I recommend the <a href="https://www.gbxcart.com/">GBxCart</a>.
    </div>
    <noscript>
      Looks like you have JS disabled. This tool needs javascript to function!
    </noscript>
    <div id="app">
      <h2>1. Add Game ROMs</h2>
      <section>
        <table>
          <thead>
            <tr>
              <th>       
                <button v-on:click="removeAllRoms" class="remove-all" :disabled="roms.length == 0" type="button" >
                  <label>Remove All</label>
                </button>
              </th>
              <th>Title</th>
              <th>Mapper</th>
              <th>ROM</th>
              <th>RAM</th>
              <th>Blocks</th>
              <th>Menu Title</th>
              <th>Preview</th>
            </tr>
          </thead>
          <tbody>
            <tr v-for="(rom, index) in roms" v-bind:key="index">
              <td>
                <button id="remove-rom" v-on:click="removeROM(index)" type="button">✗</button>
                <button :disabled="index == 0" v-on:click="moveUp(index)" type="button">↑</button>
                <button :disabled="index == (roms.length - 1)" v-on:click="moveDown(index)" type="button">↓</button>
              </td>
              <td>{{ rom.title }}</td>
              <td>{{ rom.type }}</td>
              <td>{{ rom.romSizeKB() + 'k'}}</td>
              <td>{{ rom.ramSizeKB() + 'k' }}</td>
              <td>{{ rom.paddedRomSizeKB() / 128 + ' (' + rom.paddedRomSizeKB() + 'k)'}}</td>
              <td>
                <input type="text" class='menu-text' :value="rom.menuText" @input="e => updateMenuText(rom, e.target.value)"/>
              </td>
              <td>
                <bitmap-preview :data="rom.bitmapPreviewBuffer"/>
              </td>
            </tr>
          </tbody>
          <tfoot>
            <tr>
              <td>
                <button v-on:click="triggerAddRomLabel" class="upload" :disabled="!menu.present() || romOverflow" type="button">
                  <label for="romFileInput" ref="addRomLabel" v-on:click="stopPropagation">Add Games</label>
                </button>
                <input style="display: none" id="romFileInput" type="file" v-on:change="addROM" :disabled="!menu.present() || romOverflow" accept=".gb,.gbc" multiple>
              </td>
              <td>
                <button v-on:click="triggerAddMenuLabel" class="upload" type="button">
                  <label for="menuFileInput" ref="addMenuLabel" v-on:click="stopPropagation">Load From File</label>
                </button>
                <input style="display: none" id="menuFileInput" type="file" v-on:change="addMenu" accept=".gb,.gbc">
              </td>
              <td></td>
              <td>{{ processor.romTotalKB() + 'k' }}</td>
              <td>{{ processor.ramUsedKB() + 'k' }}</td>
              <td :class="{ overflow: romOverflow }">
                {{ processor.romUsedKB() / 128 + ' (' + processor.romUsedKB() + 'k)'}}
              </td>
              <td :class="{ overflow: romOverflow }">
                <span v-if="romOverflow">Limit is 7 blocks</span>
              </td>
              <td></td>
            </tr>
          </tfoot>
        </table>
      </section>

      <h2>2. Tweak Settings </h2>
      <section>
        <div class="settings-row">
          <span class="settings-label">Menu Font: </span>

          <input type="radio" id="font0" name="font" value="0" v-model="fontIndex">
          <label for="font0" id="gameboy" class="radio-label">Game Boy</label>

          <input type="radio" id="font1" name="font" value="1" v-model="fontIndex">
          <label for="font1" id="pokemon" class="radio-label">POKEMON</label>

          <input type="radio" id="font2" name="font" value="2" v-model="fontIndex">
          <label for="font2" id="nokia" class="radio-label">Nokia</label>

          <input type="radio" id="font3" name="font" value="3" v-model="fontIndex">
          <label for="font3" id="gamer" class="radio-label">Gamer</label>
        </div>

        <div class="settings-row">
          <label class="settings-label" id="disableCGB-label" for="disableCGB-input">Disable CGB Palette: </label>
          <input id="disableCGB-input" type="checkbox" v-model:checked="disableCGB"/>
          The Game Boy will load the menu (and all games) in DMG palette mode.
        </div>

        <div class="settings-row">
          <label class="settings-label" id="forceDMG-label" for="forceDMG-input">Force DMG Menu/Music: </label>
          <input id="forceDMG-input" type="checkbox" v-model:checked="forceDMG"/>
          The more minimal DMG menu and music will be used. <a href="img/menu_comparison.png">Comparison here.</a>
        </div>

        <div class="settings-row">
          <label class="settings-label" id="filename-label" for="filename-input">Download Filename: </label>
          <input id="filename-input" type="text" v-model:value="filename"/>
        </div>
      </section>

      <h2>3. Download Files</h2>
      <section>
        <a class='download-link' :download="filename + '.gb'" :href="downloadEnabled ? romData : null" type="application/octet-stream" v-on:click="downloadRomFile" :class="{ disabled: !downloadEnabled }">Download GB File</a>
        /
        <a class='download-link' :download="filename + '.map'" :href="downloadEnabled ? mapData : null" type="application/octet-stream" v-on:click="downloadMapFile" :class="{ disabled: !downloadEnabled }">Download MAP File</a>
      </section>
    </div>

    <canvas id="scratch-canvas"></canvas>

    <footer>
      <a href="https://github.com/orangeglo/gbnp">view this project on github</a>
      -
      by orangeglo (orangeglo#6197 on Discord)
    </footer>

    <script src="script/app.js"></script>
  </body>
</html>
